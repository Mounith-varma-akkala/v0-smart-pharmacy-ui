{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Mounith%20Varma%20Akkala/OneDrive/Desktop/New%20folder%20%282%29/v0-smart-pharmacy-ui/app/api/suppliers/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n)\r\n\r\nexport async function GET() {\r\n  try {\r\n    const { data: suppliers, error } = await supabase\r\n      .from('suppliers')\r\n      .select(`\r\n        *,\r\n        supplier_medicines (\r\n          medicine_name\r\n        ),\r\n        supplier_orders (\r\n          id,\r\n          order_date,\r\n          delivered_on_time\r\n        )\r\n      `)\r\n      .order('name')\r\n\r\n    if (error) throw error\r\n\r\n    // Process the data to match frontend expectations\r\n    const processedSuppliers = suppliers?.map(supplier => ({\r\n      id: supplier.id,\r\n      name: supplier.name,\r\n      contact_person: supplier.contact_person,\r\n      email: supplier.email,\r\n      phone: supplier.phone,\r\n      address: supplier.address,\r\n      medicines_supplied: supplier.supplier_medicines?.map((sm: any) => sm.medicine_name) || [],\r\n      lead_time_days: supplier.lead_time_days,\r\n      reliability_rating: supplier.reliability_rating,\r\n      price_trend: supplier.price_trend,\r\n      last_order_date: supplier.last_order_date,\r\n      total_orders: supplier.supplier_orders?.length || 0,\r\n      on_time_delivery_rate: supplier.supplier_orders?.length > 0 \r\n        ? Math.round((supplier.supplier_orders.filter((order: any) => order.delivered_on_time).length / supplier.supplier_orders.length) * 100)\r\n        : 0,\r\n      auto_reorder_enabled: supplier.auto_reorder_enabled\r\n    })) || []\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      suppliers: processedSuppliers \r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching suppliers:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to fetch suppliers' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json()\r\n    \r\n    const { data: supplier, error } = await supabase\r\n      .from('suppliers')\r\n      .insert([{\r\n        name: body.name,\r\n        contact_person: body.contact_person,\r\n        email: body.email,\r\n        phone: body.phone,\r\n        address: body.address,\r\n        lead_time_days: body.lead_time_days,\r\n        reliability_rating: body.reliability_rating || 0,\r\n        price_trend: body.price_trend || 'stable',\r\n        auto_reorder_enabled: body.auto_reorder_enabled || false\r\n      }])\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw error\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      supplier \r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Error creating supplier:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to create supplier' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,gMAAY;AAKtB,eAAe;IACpB,IAAI;QACF,MAAM,EAAE,MAAM,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,SACtC,IAAI,CAAC,aACL,MAAM,CAAC,CAAC;;;;;;;;;;MAUT,CAAC,EACA,KAAK,CAAC;QAET,IAAI,OAAO,MAAM;QAEjB,kDAAkD;QAClD,MAAM,qBAAqB,WAAW,IAAI,CAAA,WAAY,CAAC;gBACrD,IAAI,SAAS,EAAE;gBACf,MAAM,SAAS,IAAI;gBACnB,gBAAgB,SAAS,cAAc;gBACvC,OAAO,SAAS,KAAK;gBACrB,OAAO,SAAS,KAAK;gBACrB,SAAS,SAAS,OAAO;gBACzB,oBAAoB,SAAS,kBAAkB,EAAE,IAAI,CAAC,KAAY,GAAG,aAAa,KAAK,EAAE;gBACzF,gBAAgB,SAAS,cAAc;gBACvC,oBAAoB,SAAS,kBAAkB;gBAC/C,aAAa,SAAS,WAAW;gBACjC,iBAAiB,SAAS,eAAe;gBACzC,cAAc,SAAS,eAAe,EAAE,UAAU;gBAClD,uBAAuB,SAAS,eAAe,EAAE,SAAS,IACtD,KAAK,KAAK,CAAC,AAAC,SAAS,eAAe,CAAC,MAAM,CAAC,CAAC,QAAe,MAAM,iBAAiB,EAAE,MAAM,GAAG,SAAS,eAAe,CAAC,MAAM,GAAI,OACjI;gBACJ,sBAAsB,SAAS,oBAAoB;YACrD,CAAC,MAAM,EAAE;QAET,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,WAAW;QACb;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA4B,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,GAAG,MAAM,SACrC,IAAI,CAAC,aACL,MAAM,CAAC;YAAC;gBACP,MAAM,KAAK,IAAI;gBACf,gBAAgB,KAAK,cAAc;gBACnC,OAAO,KAAK,KAAK;gBACjB,OAAO,KAAK,KAAK;gBACjB,SAAS,KAAK,OAAO;gBACrB,gBAAgB,KAAK,cAAc;gBACnC,oBAAoB,KAAK,kBAAkB,IAAI;gBAC/C,aAAa,KAAK,WAAW,IAAI;gBACjC,sBAAsB,KAAK,oBAAoB,IAAI;YACrD;SAAE,EACD,MAAM,GACN,MAAM;QAET,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA4B,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}