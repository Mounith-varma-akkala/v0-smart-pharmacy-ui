{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Mounith%20Varma%20Akkala/OneDrive/Desktop/New%20folder%20%282%29/v0-smart-pharmacy-ui/app/api/analytics/sales-heatmap/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n)\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Get sales data from last 30 days\r\n    const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)\r\n    \r\n    const { data: salesData, error } = await supabase\r\n      .from('sales')\r\n      .select('created_at, quantity')\r\n      .gte('created_at', thirtyDaysAgo.toISOString())\r\n\r\n    if (error) throw error\r\n\r\n    // Initialize heatmap data structure\r\n    const heatmapData = []\r\n    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\r\n    \r\n    // Initialize all day-hour combinations\r\n    for (let dayIndex = 0; dayIndex < 7; dayIndex++) {\r\n      for (let hour = 0; hour < 24; hour++) {\r\n        heatmapData.push({\r\n          day: days[dayIndex],\r\n          hour: hour,\r\n          sales: 0\r\n        })\r\n      }\r\n    }\r\n\r\n    // Process sales data\r\n    salesData?.forEach(sale => {\r\n      const saleDate = new Date(sale.created_at)\r\n      const dayOfWeek = saleDate.getDay() // 0 = Sunday\r\n      const hour = saleDate.getHours()\r\n      \r\n      const dataPoint = heatmapData.find(d => \r\n        d.day === days[dayOfWeek] && d.hour === hour\r\n      )\r\n      \r\n      if (dataPoint) {\r\n        dataPoint.sales += sale.quantity\r\n      }\r\n    })\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      heatmap: heatmapData \r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Error generating sales heatmap:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to generate sales heatmap' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,gMAAY;AAKtB,eAAe;IACpB,IAAI;QACF,mCAAmC;QACnC,MAAM,gBAAgB,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK;QAEhE,MAAM,EAAE,MAAM,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,SACtC,IAAI,CAAC,SACL,MAAM,CAAC,wBACP,GAAG,CAAC,cAAc,cAAc,WAAW;QAE9C,IAAI,OAAO,MAAM;QAEjB,oCAAoC;QACpC,MAAM,cAAc,EAAE;QACtB,MAAM,OAAO;YAAC;YAAO;YAAO;YAAO;YAAO;YAAO;YAAO;SAAM;QAE9D,uCAAuC;QACvC,IAAK,IAAI,WAAW,GAAG,WAAW,GAAG,WAAY;YAC/C,IAAK,IAAI,OAAO,GAAG,OAAO,IAAI,OAAQ;gBACpC,YAAY,IAAI,CAAC;oBACf,KAAK,IAAI,CAAC,SAAS;oBACnB,MAAM;oBACN,OAAO;gBACT;YACF;QACF;QAEA,qBAAqB;QACrB,WAAW,QAAQ,CAAA;YACjB,MAAM,WAAW,IAAI,KAAK,KAAK,UAAU;YACzC,MAAM,YAAY,SAAS,MAAM,GAAG,aAAa;;YACjD,MAAM,OAAO,SAAS,QAAQ;YAE9B,MAAM,YAAY,YAAY,IAAI,CAAC,CAAA,IACjC,EAAE,GAAG,KAAK,IAAI,CAAC,UAAU,IAAI,EAAE,IAAI,KAAK;YAG1C,IAAI,WAAW;gBACb,UAAU,KAAK,IAAI,KAAK,QAAQ;YAClC;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAmC,GAC5D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}